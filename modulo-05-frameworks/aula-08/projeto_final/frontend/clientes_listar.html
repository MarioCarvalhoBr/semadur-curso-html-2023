<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Site de Cursos</title>
    <link rel="stylesheet" href="estilo.css">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous">
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
      rel="stylesheet">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">

          <a class="navbar-brand" href="index.html">
            <i class="bi bi-house-fill"></i>
            Site de Fictício
          </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle  active" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Clientes
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="clientes_cadastrar.html">Cadastrar</a></li>
                <li><a class="dropdown-item" href="clientes_listar.html">Listar</a></li>
              </ul>
            </li>

            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle active" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Produtos
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Cadastrar</a></li>
                <li><a class="dropdown-item" href="#">Listar</a></li>
              </ul>
            </li>

            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle active" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Cursos
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Docker</a></li>
                <li><a class="dropdown-item" href="#">Kubernetes</a></li>
                <li><a class="dropdown-item" href="#">Jenkins</a></li>
                <li><a class="dropdown-item" href="#">Git</a></li>

              </ul>
            </li>



              <li class="nav-item">
                <a class="nav-link active" href="sobre.html">Sobre</a>
              </li>
          </ul>
         
        </div>
      </div>
    </nav>

    <div class="container py-3">
      <main>

        <h2 class="display-6 text-center mb-4">Gerenciamento de Clientes</h2>
        <div class="table-responsive">
          <table class="table table-striped table-hover text-center"
          id="tabelaClientes">
          <thead>
            <!--CREATE TABLE clientes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    rua VARCHAR(255) NOT NULL,
    numero VARCHAR(255) NOT NULL,
    bairro VARCHAR(255) NOT NULL,
    cidade VARCHAR(255) NOT NULL,
    estado VARCHAR(255) NOT NULL,
    cep VARCHAR(255) NOT NULL,
);-->
            <tr>
              <th scope="col">ID</th>
              <th scope="col">Nome</th>
              <th scope="col">E-mail</th>
              <th scope="col">Rua</th>
              <th scope="col">Número</th>
              <th scope="col">Bairro</th>
              <th scope="col">Cidade</th>
              <th scope="col">Estado</th>
              <th scope="col">CEP</th>
              <th scope="col">Ações</th>
            </tr>
          </thead>
          <tbody>

          </tbody>
        </table>
        </div>
        

      </main>

      <div class="container">
        <footer
          class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
          <p class="col-md-4 mb-0 text-body-secondary">&copy; 2023 Site de
            Fictício, Todos os direitos reservados</p>

          <a href="/"
            class="col-md-4 d-flex align-items-center justify-content-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
            <svg class="bi me-2" width="40" height="32"><use
                xlink:href="#bootstrap" /></svg>
          </a>

          <ul class="nav col-md-4 justify-content-end">
            <li class="nav-item"><a href="https://facebook.com"
                class="nav-link px-2 text-body-secondary"><i
                  class="bi bi-facebook"></i></a></li>
            <li class="nav-item"><a href="https://x.com"
                class="nav-link px-2 text-body-secondary"><i
                  class="bi bi-twitter"></i></a></li>
            <li class="nav-item"><a href="https://instagram.com"
                class="nav-link px-2 text-body-secondary"><i
                  class="bi bi-instagram"></i></a></li>
            <li class="nav-item"><a href="https://github.com"
                class="nav-link px-2 text-body-secondary"><i
                  class="bi bi-github"></i></a></li>
          </ul>
        </footer>
      </div>
    </div>
  </body>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
  <script>
    function popularClientes(){
        // Consultar a api e preencher a tabela tabelaClientes
        fetch('http://localhost:3000/clientes').then(resposta => {
          return resposta.json();
        }).then(clientes => {
          console.log(clientes);
          let tabelaClientes = document.getElementById('tabelaClientes');
          for (let index = 0; index < clientes.length; index++) {
            const cliente = clientes[index];
            let linha = `
              <tr>
                <th scope="row">${cliente.id}</th>
                <td>${cliente.nome}</td>
                <td>${cliente.email}</td>
                <td>${cliente.rua}</td>
                <td>${cliente.numero}</td>
                <td>${cliente.bairro}</td>
                <td>${cliente.cidade}</td>
                <td>${cliente.estado}</td>
                <td>${cliente.cep}</td>
                <td>
                  <button class="btn btn-danger btn-sm" onclick="excluirCliente(${cliente.id})">Excluir</button>
                  <a href="clientes_editar.html?id=${cliente.id}" class="btn btn-warning btn-sm">Editar</a>
                </td>
              </tr>
            `;
            tabelaClientes.innerHTML += linha;
            
          }
        });
    }

    function excluirCliente(id){
      // Criar um modal de confirmação do bootstrap

      let modal = `
        <div class="modal fade" id="modalConfirmacao" tabindex="-1" aria-labelledby="modalConfirmacaoLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="modalConfirmacaoLabel">Excluir Cliente</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>

              <div class="modal-body">
                Deseja realmente excluir o cliente?
              </div>

              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Não</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal" onclick="excluirClienteConfirmado(${id})">Sim</button>
              </div>
            </div>
          </div>
        </div>
      `;
      document.body.innerHTML += modal;
      let modalConfirmacao = new bootstrap.Modal(document.getElementById('modalConfirmacao'));
      modalConfirmacao.show();
      
    }

    function excluirClienteConfirmado(id){
      fetch(`http://localhost:3000/clientes/${id}`, {
        method: 'DELETE'
      }).then(resposta => {
        if(resposta.status == 200){
          
          // Reload da página
          window.location.reload();
        }
      });
    }

    popularClientes();
  </script>

  <script>
    const alertPlaceholder = document.getElementById('liveAlertPlaceholder')
    
    const appendAlert = (message, type) => {
      const wrapper = document.createElement('div')
      wrapper.innerHTML = [
        `<div class="alert alert-${type} alert-dismissible" role="alert">`,
        `   <div>${message}</div>`,
        '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
        '</div>'
      ].join('')
    
      alertPlaceholder.append(wrapper)
    }
    
    const alertTrigger = document.getElementById('liveAlertBtn')
    if (alertTrigger) {
      alertTrigger.addEventListener('click', () => {
        appendAlert('Você entrou em contato. Aguarde nosso e-mail!', 'success')
      })
    }
  </script>
</html>